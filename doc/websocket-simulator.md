# WebSocket 模拟器使用说明

## 概述

WebSocket 模拟器是一个用于调试和测试的工具，允许你在没有真实服务端的情况下模拟 WebSocket 连接和数据推送。这对于前端开发、功能测试和调试非常有用。

## 功能特性

### 🎯 核心功能

- **模拟连接**: 模拟所有 WebSocket 端点的连接状态
- **数据生成**: 自动生成各种类型的测试数据
- **实时推送**: 可配置的数据推送频率和内容
- **手动触发**: 支持手动触发单个或批量数据推送
- **错误模拟**: 模拟连接错误来测试错误处理逻辑
- **状态监控**: 实时查看连接状态和消息统计

### 📊 支持的端点类型

- `PLAYER` - 玩家数据 (位置、生命值、装备等)
- `WORLD` - 世界数据 (时间、天气、维度等)
- `MARKER` - 标记数据
- `LOGS` - Minecraft 日志
- `LOGS_ALT` - MCP Server 日志
- `TOKEN_USAGE` - Token 使用量监控
- `EVENTS` - 游戏事件
- `TASK_MANAGER` - 任务管理
- `GENERAL` - 通用状态
- `STATUS` - 服务器状态

## 使用方法

### 1. 访问模拟器

在侧边栏的"调试工具"菜单中选择"WebSocket 模拟器"，或直接访问 `/websocket-simulator` 路径。

### 2. 启用模拟模式

1. 点击页面顶部的模拟模式开关
2. 系统会自动启用模拟服务
3. 现在可以使用模拟连接代替真实连接

### 3. 连接管理

- **连接全部**: 点击"连接全部"按钮一次性连接所有端点
- **单独连接**: 在端点列表中单独连接/断开特定端点
- **状态监控**: 查看每个端点的连接状态、消息数和错误数

### 4. 数据配置

每个端点都可以独立配置：

- **启用/禁用**: 控制是否自动推送数据
- **推送间隔**: 设置数据推送的时间间隔（毫秒）
- **手动推送**: 立即触发一次数据推送

### 5. 批量操作

- **启用所有数据推送**: 一键启用所有端点的数据推送
- **禁用所有数据推送**: 一键禁用所有端点的数据推送
- **触发所有数据推送**: 手动触发所有已连接端点的数据推送
- **设置统一间隔**: 批量设置所有端点的推送间隔

### 6. 错误模拟

点击端点操作栏中的"模拟错误"按钮可以模拟连接错误，用于测试错误处理逻辑。

### 7. 实时预览

页面底部的数据预览区域会实时显示接收到的模拟数据，包括：

- 玩家数据 (姓名、生命值、位置等)
- 世界数据 (时间、天气、维度等)
- 日志和事件统计
- Token 使用情况

## 数据类型说明

### 玩家数据 (PLAYER)

```json
{
  "type": "player_update",
  "data": {
    "name": "Steve",
    "health": 18,
    "max_health": 20,
    "position": {
      "x": 123.5,
      "y": 64.0,
      "z": -87.2,
      "yaw": 180.5,
      "pitch": 0.0
    },
    "gamemode": "survival",
    "equipment": {...},
    "inventory": {...}
  }
}
```

### 世界数据 (WORLD)

```json
{
  "type": "world_update",
  "data": {
    "time": {
      "time_of_day": 6000,
      "formatted_time": "12:00",
      "day_count": 42
    },
    "weather": {
      "weather": "clear",
      "formatted_weather": "晴朗"
    },
    "location": {
      "dimension": "minecraft:overworld",
      "biome": "minecraft:plains"
    }
  }
}
```

### 日志数据 (LOGS)

```json
{
  "type": "log",
  "timestamp": 1640995200000,
  "level": "INFO",
  "module": "minecraft.server",
  "message": "玩家 Steve 加入了游戏"
}
```

### 事件数据 (EVENTS)

```json
{
  "type": "event",
  "id": "event_1640995200000_1234",
  "event_type": "player_join",
  "timestamp": "2021-12-31T16:00:00.000Z",
  "data": {
    "player": "Steve",
    "ip": "192.168.1.100"
  }
}
```

## 配置选项

### 默认推送间隔

- **PLAYER**: 1000ms (高频更新)
- **WORLD**: 2000ms (中频更新)
- **LOGS**: 3000ms (低频更新)
- **EVENTS**: 5000ms (低频更新)
- **TOKEN_USAGE**: 10000ms (很低频更新)

### 推荐设置

- **开发调试**: 使用较短间隔 (1-3秒) 快速查看数据变化
- **性能测试**: 使用很短间隔 (500ms-1秒) 测试高负载情况
- **UI 测试**: 使用中等间隔 (3-5秒) 观察界面更新

## 与真实模式的切换

### 切换到模拟模式

1. 在模拟器页面启用模拟模式开关
2. 或在其他页面的 WebSocket 监控中切换模式
3. 现有连接会自动断开并切换到模拟连接

### 切换回真实模式

1. 关闭模拟模式开关
2. 系统会断开所有模拟连接
3. 可以重新连接真实的 WebSocket 服务端

## 调试技巧

### 1. 数据流测试

- 启用模拟模式后访问各个功能页面
- 观察页面是否正确显示模拟数据
- 检查数据更新的实时性

### 2. 错误处理测试

- 使用"模拟错误"功能触发连接错误
- 检查应用的错误处理和恢复机制
- 验证错误提示和用户反馈

### 3. 性能测试

- 设置很短的推送间隔 (100-500ms)
- 观察应用在高频数据更新下的表现
- 检查内存使用和界面响应性

### 4. 兼容性测试

- 在模拟模式和真实模式之间切换
- 验证数据格式的一致性
- 确保功能在两种模式下都能正常工作

## 故障排除

### 模拟器无法启动

- 检查浏览器控制台是否有错误信息
- 确保没有其他页面占用模拟服务
- 尝试刷新页面重新初始化

### 数据不更新

- 确认相关端点已连接
- 检查数据推送是否已启用
- 验证推送间隔设置是否合理

### 切换模式失败

- 先断开所有现有连接
- 清除浏览器缓存
- 重新启动模拟服务

## 注意事项

1. **模拟数据**: 所有数据都是随机生成的，不代表真实游戏状态
2. **性能影响**: 高频推送可能影响浏览器性能，建议适度使用
3. **数据一致性**: 模拟数据格式与真实数据保持一致，但内容是随机的
4. **状态隔离**: 模拟模式和真实模式的连接状态是独立的

## 开发者信息

### 相关文件

- `src/services/mockWebSocketService.ts` - 模拟服务核心逻辑
- `src/utils/mockDataGenerators.ts` - 数据生成器
- `src/views/WebSocketSimulator.vue` - 模拟器 UI 界面
- `src/services/globalWebSocketService.ts` - 全局连接管理

### 扩展功能

如需添加新的端点类型或数据类型：

1. 在 `mockDataGenerators.ts` 中添加数据生成函数
2. 在 `mockWebSocketService.ts` 中添加端点处理逻辑
3. 更新 `websocketData.ts` 中的数据存储结构
4. 在模拟器 UI 中添加相应的配置选项

---

通过 WebSocket 模拟器，你可以在开发和测试过程中完全脱离真实服务端的依赖，提高开发效率和测试覆盖率。
