# 设置功能说明

## 概述

本项目现在支持完整的设置管理系统，可以通过Web界面动态配置WebSocket参数、API端点等。设置会自动保存到本地存储，并实时应用到整个应用。

## 功能特性

### 🎯 主要功能

- **实时配置更新**: 修改设置后立即生效，无需重启应用
- **持久化存储**: 设置自动保存到浏览器本地存储
- **环境变量支持**: 支持通过环境变量进行配置
- **导入/导出**: 支持JSON格式的配置导入导出
- **类型安全**: 完整的TypeScript类型支持

### 🔧 配置分类

#### WebSocket配置

- **主机**: WebSocket服务器主机地址（默认: localhost）
- **端口**: WebSocket服务器端口（默认: 20914）
- **心跳间隔**: 心跳包发送间隔（毫秒，默认: 10000）
- **重连间隔**: 连接断开后的重连间隔（毫秒，默认: 5000）
- **最大重连次数**: 最大重连尝试次数（默认: 5）
- **自动重连**: 是否启用自动重连（默认: 启用）
- **心跳**: 是否启用心跳机制（默认: 启用）

#### API配置

- **主机**: HTTP API服务器主机地址（默认: localhost）
- **端口**: HTTP API服务器端口（默认: 20914）
- **CORS**: 是否启用CORS（默认: 启用）
- **超时时间**: 请求超时时间（毫秒，默认: 10000）
- **最大重试次数**: 请求失败后的最大重试次数（默认: 3）
- **重试延迟**: 重试间隔时间（毫秒，默认: 1000）

#### 其他配置

- **LLM配置**: 大语言模型相关配置
- **机器人配置**: 玩家和机器人名称设置
- **游戏配置**: 游戏目标等设置
- **日志配置**: 日志输出配置

## 使用方法

### 1. 访问设置页面

在应用中导航到"设置"页面。

### 2. 修改配置

1. 选择要编辑的配置标签页
2. 点击对应配置卡片的"编辑"按钮
3. 在弹出的对话框中修改参数
4. 点击"保存"按钮应用更改

### 3. 导入/导出配置

- **导出**: 点击"导出配置"按钮下载JSON配置文件
- **导入**: 点击"导入配置"按钮，选择JSON配置文件进行导入

### 4. 重置配置

点击"重置配置"按钮可以恢复所有设置为默认值。

## 环境变量配置

项目支持通过环境变量进行配置，优先级：环境变量 > 用户设置 > 默认值。

### 环境变量列表

```bash
# WebSocket配置
VITE_WS_HOST=localhost                    # WebSocket主机
VITE_WS_PORT=20914                       # WebSocket端口
VITE_WS_ENABLE_HEARTBEAT=true            # 启用心跳
VITE_WS_HEARTBEAT_INTERVAL=10000         # 心跳间隔(ms)
VITE_WS_RECONNECT_INTERVAL=5000          # 重连间隔(ms)
VITE_WS_MAX_RECONNECT_ATTEMPTS=5         # 最大重连次数
VITE_WS_ENABLE_AUTO_RECONNECT=true       # 启用自动重连

# API配置
VITE_API_HOST=localhost                  # API主机
VITE_API_PORT=20914                      # API端口
VITE_API_TIMEOUT=10000                   # 请求超时(ms)
VITE_API_MAX_RETRIES=3                   # 最大重试次数
VITE_API_RETRY_DELAY=1000                # 重试延迟(ms)
VITE_API_DEBUG=false                     # 调试模式

# 其他
VITE_DEBUG=false                         # 应用调试模式
```

### 配置环境变量

1. 复制 `env.example` 文件为 `.env.local`
2. 根据需要修改环境变量值
3. 重启开发服务器

## 技术实现

### 状态管理

使用Pinia进行状态管理，设置存储在响应式store中。

### 动态WebSocket端点

WebSocket端点根据设置动态生成，支持运行时切换服务器地址。

### 配置验证

内置配置验证机制，确保配置的合法性。

## 注意事项

1. **实时生效**: 大部分配置修改后会立即生效，但某些配置可能需要刷新页面
2. **本地存储**: 配置保存在浏览器本地存储中，清除浏览器数据会丢失设置
3. **环境变量**: 环境变量配置具有最高优先级
4. **类型安全**: 所有配置都有TypeScript类型检查

## 故障排除

### 配置不生效

1. 检查浏览器控制台是否有错误信息
2. 尝试刷新页面
3. 检查本地存储是否被禁用

### WebSocket连接失败

1. 检查WebSocket主机和端口配置是否正确
2. 确认服务器正在运行
3. 检查防火墙设置

### 配置无法保存

1. 检查浏览器本地存储是否可用
2. 尝试清除浏览器缓存后重新设置
